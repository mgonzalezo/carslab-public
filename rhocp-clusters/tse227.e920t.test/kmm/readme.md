# KMM driver work and output for CGNAT

Begin by installing KMM via:
```shell
$ oc create -f 00-kmm.yaml
```
# Build on Cluster Instructions

##Create Containerfile as a ConfigMap

Create a ConfigMap that is essentially a Containerfile / Dockerfile, which tells the cluster how to build the OOT kernel module, where to get the source, etc.

```shell
$ oc create -f 02-kmm-cm-cgnat.yaml
```

##Create Module CRD

Create the Module CRD that will be used to build the OOT kernel module, reference the previously created Containerfile, push to an external registry, and rip and replace the in-tree ice module for the compiled OOT variant.

```shell
$ oc create -f 03-kmm-module-buildoncluster.yaml
```

### Observe Output from Build

```shell
$ oc logs oot-ice-cgnat-build-j9mtq-build -f
Defaulted container "docker-build" out of: docker-build, manage-dockerfile (init)
time="2024-04-04T01:30:18Z" level=info msg="Not using native diff for overlay, this may cause degraded performance for building images: kernel has CONFIG_OVERLAY_FS_REDIRECT_DIR enabled"
I0404 01:30:18.294723       1 defaults.go:112] Defaulting to storage driver "overlay" with options [mountopt=metacopy=on].
Caching blobs under "/var/cache/blobs".

Pulling image registry.redhat.io/ubi9/ubi-minimal ...
Trying to pull registry.redhat.io/ubi9/ubi-minimal:latest...
Getting image source signatures
Copying blob sha256:2895d6faeea81934722a9a23efd8814ca51c1af558a3a70983ad2f7a412cdbe8
Copying config sha256:94c0198373526084dd06c13f07db53783c7318be9bcb6d691332d591d768f596
Writing manifest to image destination
Storing signatures
Adding transient rw bind mount for /run/secrets/rhsm
Adding transient ro bind mount for /etc/pki/ca-trust
[1/2] STEP 1/7: FROM quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:c4703383dd074ac416621447ff5ed7f53a215e2301185c27c0e7ae4384feafe6 AS builder
Trying to pull quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:c4703383dd074ac416621447ff5ed7f53a215e2301185c27c0e7ae4384feafe6...
Getting image source signatures
Copying blob sha256:9eac2d4c393742793718a1994f30bfd85f0fbbabe54afeff8e2e6bed04fbc114
Copying blob sha256:97da74cc6d8fa5d1634eb1760fd1da5c6048619c264c23e62d75f3bf6b8ef5c4
Copying blob sha256:d8190195889efb5333eeec18af9b6c82313edd4db62989bd3a357caca4f13f0e
Copying blob sha256:20975753b7ac90ad96b08707f33f28a5c459dd71ec778d00c9e03bee1c698882
Copying blob sha256:b4b8e80cc41e30bfe1af37efec22809510f30e581316bad8d5a2a79509c033c0
Copying config sha256:0a3621c11388dc29690e08ecc6289896c3e78edb458997e47d62b45c8c1a60e3
Writing manifest to image destination
Storing signatures
[1/2] STEP 2/7: ARG KERNEL_VERSION
--> 4cd2c23da87
[1/2] STEP 3/7: WORKDIR /usr/src
--> ac63931dfb4
[1/2] STEP 4/7: RUN curl -X GET http://192.168.38.12/software/ice-1.12.7.3_422024.tar.gz --output ice-1.12.7.3_422024.tar.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 1247k  100 1247k    0     0   304M      0 --:--:-- --:--:-- --:--:--  304M
--> 19efdbec6b7
[1/2] STEP 5/7: RUN tar -xvf ice-1.12.7.3_422024.tar.gz
<output suppressed>
--> a162eabec11
[1/2] STEP 6/7: WORKDIR /usr/src/ice-1.12.7.3/src
--> 2e75d16cfcf
[1/2] STEP 7/7: RUN make install KSRC=/usr/src/kernels/\${KERNEL_VERSION}
filtering include/net/flow_keys.h out
filtering include/linux/device/class.h out
all files (for given query) filtered out
filtering include/linux/device/class.h out
filtering include/linux/device/class.h out
filtering include/linux/gnss.h out
all files (for given query) filtered out
filtering include/linux/jump_label_type.h out
filtering include/linux/jump_label_type.h out
     1	/* Autogenerated for KSRC=/usr/src/kernels/4.18.0-372.69.1.el8_6.x86_64 via kcompat-generator.sh */
     2	#define HAVE_DEVLINK_FLASH_UPDATE_PARAMS
     3	#define HAVE_DEVLINK_FLASH_UPDATE_PARAMS_FW
     4	#define HAVE_DEVLINK_HEALTH
     5	#define HAVE_DEVLINK_HEALTH_DEFAULT_AUTO_RECOVER
     6	#define HAVE_DEVLINK_HEALTH_OPS_EXTACK
     7	#define HAVE_DEVLINK_INFO_DRIVER_NAME_PUT
     8	#define HAVE_DEVLINK_PARAMS
     9	#define HAVE_DEVLINK_PARAMS_PUBLISH
    10	#define HAVE_DEVLINK_PORT_NEW
    11	#define HAVE_DEVLINK_PORT_SPLIT
    12	#define HAVE_DEVLINK_PORT_SPLIT_EXTACK
    13	#define HAVE_DEVLINK_PORT_TYPE_ETH_HAS_NETDEV
    14	#define HAVE_DEVLINK_REGIONS
    15	#define HAVE_DEVLINK_REGION_OPS_SNAPSHOT
    16	#define HAVE_DEVLINK_REGION_OPS_SNAPSHOT_OPS
    17	#define HAVE_DEVLINK_REGISTER_SETS_DEV
    18	#define HAVE_DEVLINK_RELOAD_ENABLE_DISABLE
    19	#define HAVE_DEVLINK_PORT_FLAVOUR_PCI_SF
    20	#define HAVE_DEVLINK_RELOAD_ACTION_AND_LIMIT
    21	#define NEED_DEVLINK_RESOURCES_UNREGISTER_NO_RESOURCE
    22	#define NEED_DEVLINK_TO_DEV
    23	#define NEED_DEVLINK_UNLOCKED_RESOURCE
    24	#define HAVE_NDO_FDB_ADD_VID
    25	#define HAVE_NDO_GET_DEVLINK_PORT
    26	#define HAVE_NDO_UDP_TUNNEL_CALLBACK
    27	#define NEED_NETIF_NAPI_ADD_NO_WEIGHT
    28	#define HAVE_ETHTOOL_FLOW_RSS
    29	#define HAVE_XDP_DO_FLUSH
    30	#define NEED_NO_NETDEV_PROG_XDP_WARN_ACTION
    31	#define HAVE_FLOW_DISSECTOR_KEY_CVLAN
    32	#define HAVE_CDEV_DEVICE
    33	#define HAVE_POLL_T
    34	#define NEED_CLASS_CREATE_WITH_MODULE_PARAM
    35	#define NEED_CLASS_CREATE_WITH_MODULE_PARAM
    36	#define HAVE_PER_VF_MSIX_SYSFS
    37	#define HAVE_STRUCT_PCI_DEV_PTM_ENABLED
    38	#define HAVE_COMPLETION_RAW_SPINLOCK
    39	#define NEED_DEBUGFS_LOOKUP_AND_REMOVE
    40	#define HAVE_IOMMU_DEV_FEAT_AUX
    41	#define HAVE_STRUCT_STATIC_KEY_FALSE
    42	#define HAVE_MDEV_GET_DRVDATA
    43	#define NEED_DIFF_BY_SCALED_PPM
    44	#define HAVE_TRACE_ENABLED_SUPPORT
    45	#define HAVE_U64_STATS_FETCH_BEGIN_IRQ
    46	#define HAVE_U64_STATS_FETCH_RETRY_IRQ
    47	#define HAVE_LMV1_SUPPORT
<output suppressed>
make[1]: Entering directory '/usr/src/kernels/4.18.0-372.69.1.el8_6.x86_64'
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_main.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_controlq.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_common.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_nvm.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_switch.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_sched.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_base.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_lib.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_txrx_lib.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_txrx.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_fltr.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_irq.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_pf_vsi_vlan_ops.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_vsi_vlan_ops.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_vsi_vlan_lib.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_tc_lib.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_fdir.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_ethtool_fdir.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_acl_main.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_acl.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_acl_ctrl.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_vlan_mode.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_ddp.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_flex_pipe.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_flow.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_parser.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_imem.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_pg_cam.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_metainit.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_bst_tcam.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_ptype_mk.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_mk_grp.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_proto_grp.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_flg_rd.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_xlt_kb.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_parser_rt.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_peer_support.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_lag.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_fwlog.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_ieps.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_gnss.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_ethtool.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_devlink.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_fw_update.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_eswitch.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_repr.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_idc.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_debugfs.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_dcf.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_sriov.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_vf_mbx.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_vf_vsi_vlan_ops.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_virtchnl_allowlist.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_vf_adq.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_virtchnl.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_virtchnl_fdir.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_virtchnl_fsub.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_vf_lib.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_ptp.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_ptp_hw.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_dcb.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_dcb_nl.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_dcb_lib.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_arfs.o
  CC [M]  /usr/src/ice-1.12.7.3/src/ice_xsk.o
  CC [M]  /usr/src/ice-1.12.7.3/src/kcompat.o
  CC [M]  /usr/src/ice-1.12.7.3/src/kcompat_gnss.o
  LD [M]  /usr/src/ice-1.12.7.3/src/ice.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /usr/src/ice-1.12.7.3/src/ice.mod.o
  LD [M]  /usr/src/ice-1.12.7.3/src/ice.ko
make[1]: Leaving directory '/usr/src/kernels/4.18.0-372.69.1.el8_6.x86_64'
make[1]: Entering directory '/usr/src/kernels/4.18.0-372.69.1.el8_6.x86_64'
  INSTALL /usr/src/ice-1.12.7.3/src/ice.ko
  DEPMOD  4.18.0-372.69.1.el8_6.x86_64
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_del_rdma_qset
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_add_rdma_qset
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_rdma_update_vsi_filter
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_rdma_request_reset
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_get_qos_params
make[1]: Leaving directory '/usr/src/kernels/4.18.0-372.69.1.el8_6.x86_64'
make auxiliary_install
make[1]: Entering directory '/usr/src/ice-1.12.7.3/src'
filtering include/net/flow_keys.h out
filtering include/linux/device/class.h out
all files (for given query) filtered out
filtering include/linux/device/class.h out
filtering include/linux/device/class.h out
filtering include/linux/gnss.h out
all files (for given query) filtered out
filtering include/linux/jump_label_type.h out
filtering include/linux/jump_label_type.h out
make[1]: 'auxiliary_install' is up to date.
make[1]: Leaving directory '/usr/src/ice-1.12.7.3/src'
install -D -m 644 ../ddp/ice-1.3.35.0.pkg /lib/firmware/updates/intel/ice/ddp/ice-1.3.35.0.pkg
(cd /lib/firmware/updates/intel/ice/ddp && ln -sf ice-1.3.35.0.pkg ice.pkg)
install -D -m 644 ../ddp/LICENSE /lib/firmware/updates/intel/ice/ddp/LICENSE \
	2>/dev/null || true
install -D -m 644 ice.7.gz //usr/man/man7/ice.7.gz
/sbin/depmod -e -F /usr/src/kernels/4.18.0-372.69.1.el8_6.x86_64/System.map  -a 4.18.0-372.69.1.el8_6.x86_64
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_del_rdma_qset
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_add_rdma_qset
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_rdma_update_vsi_filter
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_rdma_request_reset
depmod: WARNING: /lib/modules/4.18.0-372.69.1.el8_6.x86_64/kernel/drivers/infiniband/hw/irdma/irdma.ko.xz needs unknown symbol ice_get_qos_params
Unable to update initramfs. You may need to do this manually.
--> 707f03564f7
[2/2] STEP 1/9: FROM registry.redhat.io/ubi9/ubi-minimal
[2/2] STEP 2/9: ARG KERNEL_VERSION
--> 2e629332974
[2/2] STEP 3/9: RUN microdnf install kmod -y

(microdnf:1): librhsm-WARNING **: 01:32:24.611: Found 0 entitlement certificates

(microdnf:1): librhsm-WARNING **: 01:32:24.612: Found 0 entitlement certificates
Downloading metadata...
Downloading metadata...
Downloading metadata...
Package               Repository            Size
Installing:                                     
 kmod-28-9.el9.x86_64 ubi-9-baseos-rpms 133.1 kB
Transaction Summary:
 Installing:        1 packages
 Reinstalling:      0 packages
 Upgrading:         0 packages
 Obsoleting:        0 packages
 Removing:          0 packages
 Downgrading:       0 packages
Downloading packages...
Running transaction test...
Installing: kmod;28-9.el9;x86_64;ubi-9-baseos-rpms
Complete.
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-appstream-rpms-9-x86_64/gpgdir/S.gpg-agent\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-appstream-rpms-9-x86_64/gpgdir/S.gpg-agent.browser\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-appstream-rpms-9-x86_64/gpgdir/S.gpg-agent.extra\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-appstream-rpms-9-x86_64/gpgdir/S.gpg-agent.ssh\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-appstream-rpms-9-x86_64/gpgdir/S.scdaemon\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-baseos-rpms-9-x86_64/gpgdir/S.gpg-agent\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-baseos-rpms-9-x86_64/gpgdir/S.gpg-agent.browser\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-baseos-rpms-9-x86_64/gpgdir/S.gpg-agent.extra\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-baseos-rpms-9-x86_64/gpgdir/S.gpg-agent.ssh\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-baseos-rpms-9-x86_64/gpgdir/S.scdaemon\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-codeready-builder-9-x86_64/gpgdir/S.gpg-agent\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-codeready-builder-9-x86_64/gpgdir/S.gpg-agent.browser\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-codeready-builder-9-x86_64/gpgdir/S.gpg-agent.extra\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-codeready-builder-9-x86_64/gpgdir/S.gpg-agent.ssh\" since it is a socket"
time="2024-04-04T01:32:26Z" level=warning msg="archive: skipping \"/var/lib/containers/storage/overlay/06ed5d2be2ba3e6642dd76f82a5bb345fbe1c6f5ecc3addcb5a55d2062981290/merged/var/cache/yum/metadata/ubi-9-codeready-builder-9-x86_64/gpgdir/S.scdaemon\" since it is a socket"
--> 11512ae60ce
[2/2] STEP 4/9: RUN mkdir -p /opt/lib/modules/${KERNEL_VERSION}
--> 1fcf2d9ad9b
[2/2] STEP 5/9: COPY --from=builder /usr/lib/modules/${KERNEL_VERSION}/updates/drivers/net/ethernet/intel/ice/ice.ko /opt/lib/modules/${KERNEL_VERSION}/
--> 4f2ba08c1bb
[2/2] STEP 6/9: RUN ls /opt/lib/modules/${KERNEL_VERSION}
ice.ko
--> 8821237e719
[2/2] STEP 7/9: RUN depmod -b /opt ${KERNEL_VERSION}
depmod: WARNING: could not open modules.order at /opt/lib/modules/4.18.0-372.69.1.el8_6.x86_64: No such file or directory
depmod: WARNING: could not open modules.builtin at /opt/lib/modules/4.18.0-372.69.1.el8_6.x86_64: No such file or directory
--> 5d38a6d79b5
[2/2] STEP 8/9: ENV "OPENSHIFT_BUILD_NAME"="oot-ice-cgnat-build-j9mtq" "OPENSHIFT_BUILD_NAMESPACE"="openshift-kmm"
--> 03ac57f302f
[2/2] STEP 9/9: LABEL "io.openshift.build.name"="oot-ice-cgnat-build-j9mtq" "io.openshift.build.namespace"="openshift-kmm"
[2/2] COMMIT temp.builder.openshift.io/openshift-kmm/oot-ice-cgnat-build-j9mtq:dd40c9cf
--> cc057bfdfb7
[Warning] one or more build args were not consumed: [KERNEL_FULL_VERSION MOD_NAME MOD_NAMESPACE]
Successfully tagged temp.builder.openshift.io/openshift-kmm/oot-ice-cgnat-build-j9mtq:dd40c9cf
cc057bfdfb7efb66a56eaff5d7f1396db193a65e1891d8ab230c4072e2f64c76

Pushing image quay.io/dcain/oot-ice-cgnat/oot-ice-cgnat:4.18.0-372.69.1.el8_6.x86_64 ...
Getting image source signatures
Copying blob sha256:70b1f831b9566f970bfa35565293459d36af1607a11cc5cab073e9bef45d607b
Copying blob sha256:bae966b55c4a84f6dee6624637cc7761821b9c63770560587e0f45761178bfa8
Copying blob sha256:47b8f538cb08382b7cd1eb2593b11740fc858089c2cb1ccc558eb7d3af6ac729
Copying blob sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef
Copying blob sha256:2895d6faeea81934722a9a23efd8814ca51c1af558a3a70983ad2f7a412cdbe8
Copying blob sha256:d02d38fa171501f06e753af97ba436eddcfbdd8e57898332a1bc36ea0abb3156
Copying config sha256:cc057bfdfb7efb66a56eaff5d7f1396db193a65e1891d8ab230c4072e2f64c76
Writing manifest to image destination
Storing signatures
Successfully pushed quay.io/dcain/oot-ice-cgnat/oot-ice-cgnat@sha256:1b08c9c8c224cfd392d3d979c35380aafb5c0ab4e965e0eddab15b492568cce1
Push successful
```

## SSH to openshift node, look at driver
Use ssh or oc debug container.

```shell
[root@sno ~]# cat /sys/bus/pci/drivers/ice/module/version 
1.12.7.3
```
## Look at dmesg output

```shell
[ 3489.786095] ice: module unloaded
[ 3489.817002] ice: loading out-of-tree module taints kernel.
[ 3489.817534] ice: module verification failed: signature and/or required key missing - tainting kernel
[ 3489.827403] ice: Intel(R) Ethernet Connection E800 Series Linux Driver - version 1.12.7.3
[ 3489.827405] ice: Copyright (C) 2018-2024 Intel Corporation
[ 3490.231154] ice 0000:10:00.0: The DDP package was successfully loaded: ICE OS Default Package version 1.3.26.0
[ 3490.277116] ice 0000:10:00.0: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3490.282617] ice 0000:10:00.0: PTP init successful
[ 3490.285750] ice 0000:10:00.0 ens1f0: renamed from eth0
[ 3490.526164] ice 0000:10:00.0: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3490.526170] ice 0000:10:00.0: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3490.526461] ice 0000:10:00.0: Commit DCB Configuration to the hardware
[ 3490.528222] ice 0000:10:00.0 ens1f0: A parallel fault was detected.
[ 3490.528247] ice 0000:10:00.0 ens1f0: Possible Solution: Check link partner connection and configuration.
[ 3490.528268] ice 0000:10:00.0 ens1f0: Port Number: 3.
[ 3490.533306] IPv6: ADDRCONF(NETDEV_UP): ens1f0: link is not ready
[ 3490.713380] ice 0000:10:00.1: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 3490.728548] IPv6: ADDRCONF(NETDEV_UP): ens1f0: link is not ready
[ 3490.761927] ice 0000:10:00.1: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3490.768760] ice 0000:10:00.1 ens1f1: renamed from eth0
[ 3490.768795] ice 0000:10:00.1: PTP init successful
[ 3491.018397] ice 0000:10:00.1: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3491.018401] ice 0000:10:00.1: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3491.018435] ice 0000:10:00.1: Commit DCB Configuration to the hardware
[ 3491.026162] IPv6: ADDRCONF(NETDEV_UP): ens1f1: link is not ready
[ 3491.151919] ice 0000:10:00.2: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 3491.168888] ice 0000:10:00.1 ens1f1: NIC Link is up 25 Gbps Full Duplex, Requested FEC: RS-FEC, Negotiated FEC: RS-FEC, Autoneg Advertised: Off, Autoneg Negotiated: False, Flow Control: None
[ 3491.197538] device ens1f1 entered promiscuous mode
[ 3491.217151] ice 0000:10:00.2: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3491.222024] ice 0000:10:00.2 ens1f2: renamed from eth0
[ 3491.222059] ice 0000:10:00.2: PTP init successful
[ 3491.505006] ice 0000:10:00.2: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3491.505011] ice 0000:10:00.2: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3491.505055] ice 0000:10:00.2: Commit DCB Configuration to the hardware
[ 3491.506895] ice 0000:10:00.2 ens1f2: Module is not present.
[ 3491.506917] ice 0000:10:00.2 ens1f2: Possible Solution 1: Check that the module is inserted correctly.
[ 3491.506939] ice 0000:10:00.2 ens1f2: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 3491.506974] ice 0000:10:00.2 ens1f2: Port Number: 2.
[ 3491.515106] IPv6: ADDRCONF(NETDEV_UP): ens1f2: link is not ready
[ 3491.682366] ice 0000:10:00.3: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 3491.692248] IPv6: ADDRCONF(NETDEV_UP): ens1f2: link is not ready
[ 3491.740617] ice 0000:10:00.3: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3491.745021] ice 0000:10:00.3: PTP init successful
[ 3491.749101] ice 0000:10:00.3 ens1f3: renamed from eth0
[ 3491.985474] ice 0000:10:00.3: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3491.985479] ice 0000:10:00.3: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3491.985515] ice 0000:10:00.3: Commit DCB Configuration to the hardware
[ 3491.987381] ice 0000:10:00.3 ens1f3: Module is not present.
[ 3491.987402] ice 0000:10:00.3 ens1f3: Possible Solution 1: Check that the module is inserted correctly.
[ 3491.987425] ice 0000:10:00.3 ens1f3: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 3491.987459] ice 0000:10:00.3 ens1f3: Port Number: 0.
[ 3491.992620] IPv6: ADDRCONF(NETDEV_UP): ens1f3: link is not ready
[ 3492.086865] IPv6: ADDRCONF(NETDEV_UP): ens1f3: link is not ready
[ 3492.520123] ice 0000:12:00.0: The DDP package was successfully loaded: ICE OS Default Package version 1.3.26.0
[ 3492.605283] ice 0000:12:00.0: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3492.612800] ice 0000:12:00.0 ens2f0: renamed from eth0
[ 3492.614116] ice 0000:12:00.0: PTP init successful
[ 3492.855508] ice 0000:12:00.0: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3492.855512] ice 0000:12:00.0: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3492.855554] ice 0000:12:00.0: Commit DCB Configuration to the hardware
[ 3492.857267] ice 0000:12:00.0 ens2f0: A parallel fault was detected.
[ 3492.857289] ice 0000:12:00.0 ens2f0: Possible Solution: Check link partner connection and configuration.
[ 3492.857311] ice 0000:12:00.0 ens2f0: Port Number: 3.
[ 3492.863813] IPv6: ADDRCONF(NETDEV_UP): ens2f0: link is not ready
[ 3492.988113] IPv6: ADDRCONF(NETDEV_UP): ens2f0: link is not ready
[ 3492.994859] ice 0000:12:00.1: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 3492.999162] device ens1f1 left promiscuous mode
[ 3493.002870] device ens1f1 entered promiscuous mode
[ 3493.104705] ice 0000:12:00.1: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3493.110039] ice 0000:12:00.1 ens2f1: renamed from eth0
[ 3493.111834] ice 0000:12:00.1: PTP init successful
[ 3493.354449] ice 0000:12:00.1: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3493.354453] ice 0000:12:00.1: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3493.354487] ice 0000:12:00.1: Commit DCB Configuration to the hardware
[ 3493.407209] IPv6: ADDRCONF(NETDEV_UP): ens2f1: link is not ready
[ 3493.487856] ice 0000:12:00.2: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 3493.552953] ice 0000:12:00.1 ens2f1: NIC Link is up 25 Gbps Full Duplex, Requested FEC: RS-FEC, Negotiated FEC: RS-FEC, Autoneg Advertised: Off, Autoneg Negotiated: False, Flow Control: None
[ 3493.554763] IPv6: ADDRCONF(NETDEV_UP): ens2f1: link is not ready
[ 3493.559752] IPv6: ADDRCONF(NETDEV_UP): ens2f1: link is not ready
[ 3493.561808] ice 0000:12:00.2: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3493.565135] ice 0000:12:00.2: PTP init successful
[ 3493.583411] ice 0000:12:00.2 ens2f2: renamed from eth0
[ 3493.763297] ice 0000:12:00.2: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3493.763300] ice 0000:12:00.2: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3493.763335] ice 0000:12:00.2: Commit DCB Configuration to the hardware
[ 3493.765515] ice 0000:12:00.2 ens2f2: Module is not present.
[ 3493.765537] ice 0000:12:00.2 ens2f2: Possible Solution 1: Check that the module is inserted correctly.
[ 3493.765559] ice 0000:12:00.2 ens2f2: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 3493.765593] ice 0000:12:00.2 ens2f2: Port Number: 2.
[ 3493.794234] IPv6: ADDRCONF(NETDEV_UP): ens2f2: link is not ready
[ 3493.895500] ice 0000:12:00.3: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 3493.921357] IPv6: ADDRCONF(NETDEV_UP): ens2f2: link is not ready
[ 3493.953994] ice 0000:12:00.3: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 3493.956145] ice 0000:12:00.3: PTP init successful
[ 3493.957657] ice 0000:12:00.3 ens2f3: renamed from eth0
[ 3494.188356] ice 0000:12:00.3: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 3494.188360] ice 0000:12:00.3: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 3494.188394] ice 0000:12:00.3: Commit DCB Configuration to the hardware
[ 3494.190250] ice 0000:12:00.3 ens2f3: Module is not present.
[ 3494.190271] ice 0000:12:00.3 ens2f3: Possible Solution 1: Check that the module is inserted correctly.
[ 3494.190293] ice 0000:12:00.3 ens2f3: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 3494.190340] ice 0000:12:00.3 ens2f3: Port Number: 0.
```
## Unloading module
Note that this currently removes the ice driver module completely.  if you only have 800 series intel NICs, this essentially removes network access from the node.
```shell
oc delete -f 03-kmm-module-buildoncluster.yaml
```
# Pre-Built Instructions

These instructions were created with the previous CGNAT Intel shared OOT version, and are being left here for posterity.

## Get Driver Toolkit Digest for OpenShift version
```shell
$ oc adm release info 4.12.44 --image-for=driver-toolkit
quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:bbd15c05271b311110f598a254d8ee8260adb5c62af9e0f80da6a6e167d5539d
```

## Pull Driver Toolkit locally to use
```shell
$ podman pull --authfile ~/pull-secret-fun/pull-secret-2.json quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:bbd15c05271b311110f598a254d8ee8260adb5c62af9e0f80da6a6e167d5539d
```

## Create Driver Container with forked OOT ice.ko locally
```shell
$ export REGISTRY=quay.io/dcain
$ podman login -u dcain $REGISTRY 

$ podman build -f Containerfile-4.18.0-372.80.1.el8_6.x86_64 -t $REGISTRY/oot-ice-cgnat/oot-ice-cgnat:4.18.0-372.80.1.el8_6.x86_64 .
$ podman push $REGISTRY/oot-ice-cgnat/oot-ice-cgnat:4.18.0-372.80.1.el8_6.x86_64
```

## Load out of tree ice driver on ZTP cluster using KMM CR
This assumes irdma module is blacklisted like it is in the Telco DU Profile deployed by ZTP.
This assumes the cluster has read pull access from the remote registry.

```shell
$ oc create -f 01-kmm-module-prebuilt.yaml
```

## SSH to openshift node, look at driver
Use ssh or oc debug container.

```shell
[root@sno ~]# cat /sys/bus/pci/drivers/ice/module/version 
1.12.7_dirty
```

### dmesg output
```shell
[ 1256.117454] ice: module unloaded

[ 1256.177150] ice: loading out-of-tree module taints kernel.

[ 1256.177732] ice: module verification failed: signature and/or required key missing - tainting kernel
[ 1256.188632] ice: Intel(R) Ethernet Connection E800 Series Linux Driver - version 1.12.7_dirty
[ 1256.188653] ice: Copyright (C) 2018-2023 Intel Corporation
[ 1256.610873] ice 0000:10:00.0: The DDP package was successfully loaded: ICE OS Default Package version 1.3.26.0
[ 1256.661217] ice 0000:10:00.0: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1256.670370] ice 0000:10:00.0 ens1f0: renamed from eth0
[ 1256.671475] ice 0000:10:00.0: PTP init successful
[ 1256.833989] ice 0000:10:00.0: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1256.833994] ice 0000:10:00.0: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1256.834033] ice 0000:10:00.0: Commit DCB Configuration to the hardware
[ 1256.836628] ice 0000:10:00.0 ens1f0: A parallel fault was detected.
[ 1256.836672] ice 0000:10:00.0 ens1f0: Possible Solution: Check link partner connection and configuration.
[ 1256.836692] ice 0000:10:00.0 ens1f0: Port Number: 3.
[ 1256.844277] IPv6: ADDRCONF(NETDEV_UP): ens1f0: link is not ready
[ 1257.048572] ice 0000:10:00.1: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 1257.097668] ice 0000:10:00.1: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1257.195394] IPv6: ADDRCONF(NETDEV_UP): ens1f0: link is not ready
[ 1257.233207] ice 0000:10:00.1: PTP init successful
[ 1257.285157] ice 0000:10:00.1 ens1f1: renamed from eth0
[ 1257.488607] ice 0000:10:00.1: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1257.488624] ice 0000:10:00.1: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1257.488663] ice 0000:10:00.1: Commit DCB Configuration to the hardware
[ 1257.780207] ice 0000:10:00.2: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 1257.889169] IPv6: ADDRCONF(NETDEV_UP): ens1f1: link is not ready
[ 1258.020064] ice 0000:10:00.2: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1258.079089] ice 0000:10:00.1 ens1f1: NIC Link is up 25 Gbps Full Duplex, Requested FEC: RS-FEC, Negotiated FEC: RS-FEC, Autoneg Advertised: Off, Autoneg Negotiated: False, Flow Control: None
[ 1258.081005] IPv6: ADDRCONF(NETDEV_UP): ens1f1: link is not ready
[ 1258.091713] ice 0000:10:00.2: PTP init successful
[ 1258.092619] ice 0000:10:00.2 ens1f2: renamed from eth0
[ 1258.289433] ice 0000:10:00.2: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1258.289437] ice 0000:10:00.2: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1258.289474] ice 0000:10:00.2: Commit DCB Configuration to the hardware
[ 1258.291503] ice 0000:10:00.2 ens1f2: Module is not present.
[ 1258.291554] ice 0000:10:00.2 ens1f2: Possible Solution 1: Check that the module is inserted correctly.
[ 1258.291566] ice 0000:10:00.2 ens1f2: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 1258.291577] ice 0000:10:00.2 ens1f2: Port Number: 2.
[ 1258.294824] IPv6: ADDRCONF(NETDEV_UP): ens1f1: link is not ready
[ 1258.296720] IPv6: ADDRCONF(NETDEV_UP): ens1f2: link is not ready
[ 1258.433094] ice 0000:10:00.3: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 1258.435985] IPv6: ADDRCONF(NETDEV_UP): ens1f2: link is not ready
[ 1258.472758] device ens1f1 entered promiscuous mode
[ 1258.484996] ice 0000:10:00.3: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:02.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1258.504414] ice 0000:10:00.3 ens1f3: renamed from eth0
[ 1258.507069] ice 0000:10:00.3: PTP init successful
[ 1258.683965] ice 0000:10:00.3: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1258.683970] ice 0000:10:00.3: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1258.684008] ice 0000:10:00.3: Commit DCB Configuration to the hardware
[ 1258.686732] ice 0000:10:00.3 ens1f3: Module is not present.
[ 1258.686748] ice 0000:10:00.3 ens1f3: Possible Solution 1: Check that the module is inserted correctly.
[ 1258.686753] ice 0000:10:00.3 ens1f3: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 1258.686757] ice 0000:10:00.3 ens1f3: Port Number: 0.
[ 1258.692009] IPv6: ADDRCONF(NETDEV_UP): ens1f3: link is not ready
[ 1258.856750] IPv6: ADDRCONF(NETDEV_UP): ens1f3: link is not ready
[ 1258.856803] IPv6: ADDRCONF(NETDEV_CHANGE): ens1f1: link becomes ready
[ 1259.150954] ice 0000:12:00.0: The DDP package was successfully loaded: ICE OS Default Package version 1.3.26.0
[ 1259.215631] ice 0000:12:00.0: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1259.225259] ice 0000:12:00.0 ens2f0: renamed from eth0
[ 1259.228515] ice 0000:12:00.0: PTP init successful
[ 1259.391199] ice 0000:12:00.0: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1259.391204] ice 0000:12:00.0: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1259.391243] ice 0000:12:00.0: Commit DCB Configuration to the hardware
[ 1259.393727] ice 0000:12:00.0 ens2f0: A parallel fault was detected.
[ 1259.393765] ice 0000:12:00.0 ens2f0: Possible Solution: Check link partner connection and configuration.
[ 1259.393777] ice 0000:12:00.0 ens2f0: Port Number: 3.
[ 1259.417502] IPv6: ADDRCONF(NETDEV_UP): ens2f0: link is not ready
[ 1259.529110] ice 0000:12:00.1: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 1259.576646] ice 0000:12:00.1: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1259.585621] IPv6: ADDRCONF(NETDEV_UP): ens2f0: link is not ready
[ 1259.589570] ice 0000:12:00.1: PTP init successful
[ 1259.593457] ice 0000:12:00.1 ens2f1: renamed from eth0
[ 1259.761087] ice 0000:12:00.1: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1259.761091] ice 0000:12:00.1: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1259.761134] ice 0000:12:00.1: Commit DCB Configuration to the hardware
[ 1259.767091] IPv6: ADDRCONF(NETDEV_UP): ens2f1: link is not ready
[ 1259.901492] ice 0000:12:00.2: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 1259.918424] ice 0000:12:00.1 ens2f1: NIC Link is up 25 Gbps Full Duplex, Requested FEC: RS-FEC, Negotiated FEC: RS-FEC, Autoneg Advertised: Off, Autoneg Negotiated: False, Flow Control: None
[ 1259.993976] ice 0000:12:00.2: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1260.006965] ice 0000:12:00.2 ens2f2: renamed from eth0
[ 1260.010281] ice 0000:12:00.2: PTP init successful
[ 1260.191794] ice 0000:12:00.2: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1260.191799] ice 0000:12:00.2: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1260.191838] ice 0000:12:00.2: Commit DCB Configuration to the hardware
[ 1260.205413] ice 0000:12:00.2 ens2f2: Module is not present.
[ 1260.205461] ice 0000:12:00.2 ens2f2: Possible Solution 1: Check that the module is inserted correctly.
[ 1260.205473] ice 0000:12:00.2 ens2f2: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 1260.205484] ice 0000:12:00.2 ens2f2: Port Number: 2.
[ 1260.207581] IPv6: ADDRCONF(NETDEV_UP): ens2f2: link is not ready
[ 1260.345329] ice 0000:12:00.3: DDP package already present on device: ICE OS Default Package version 1.3.26.0
[ 1260.384332] IPv6: ADDRCONF(NETDEV_UP): ens2f2: link is not ready
[ 1260.397491] device ens1f1 left promiscuous mode
[ 1260.406517] ice 0000:12:00.3: 126.024 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x8 link at 0000:0f:04.0 (capable of 252.048 Gb/s with 16.0 GT/s PCIe x16 link)
[ 1260.428034] device ens1f1 entered promiscuous mode
[ 1260.434876] ice 0000:12:00.3: PTP init successful
[ 1260.485239] ice 0000:12:00.3 ens2f3: renamed from eth0
[ 1260.688961] ice 0000:12:00.3: DCB is enabled in the hardware, max number of TCs supported on this port are 8
[ 1260.688965] ice 0000:12:00.3: FW LLDP is disabled, DCBx/LLDP in SW mode.
[ 1260.689004] ice 0000:12:00.3: Commit DCB Configuration to the hardware
[ 1260.691201] ice 0000:12:00.3 ens2f3: Module is not present.
[ 1260.691261] ice 0000:12:00.3 ens2f3: Possible Solution 1: Check that the module is inserted correctly.
[ 1260.691279] ice 0000:12:00.3 ens2f3: Possible Solution 2: If the problem persists, use a cable/module that is found in the supported modules and cables list for this device.
[ 1260.691290] ice 0000:12:00.3 ens2f3: Port Number: 0.
```

## Unloading module
Note that this currently removes the ice driver module completely.  if you only have 800 series intel NICs, this essentially removes network access from the node.
```shell
oc delete -f 01-kmm-module.yaml
```
